# 2 - Kubernetes Cluster Configuration

The kubeadm, kubectl and kubelet were installed in both clusters and the kubeadm initialized the control-place node.
You need to join the worker node(s) to the cluster, following these steps:

1. A key pair was generated by the terraform and stored in the terraform folder. Use this key to ssh into the control-plane node and copy the `kubeadm join` command. You can find this command in the `/var/log/cloud-init-output.log` file.

   ```bash
   ssh -i owasp-key ubuntu@<control_plane_public_ip_address>
   grep "kubeadm.*discovery\|discovery.*kubeadm" /var/log/cloud-init-output.log
   ```
   
   The output will be something like:
   
   <pre>
   kubeadm join <control_plane_private_ip>:6443 --token 9lbxla.pjsptj0m9wra8tyi --discovery-token-ca-cert-hash sha256:bfd99111c1f98dcb4ec225d2ec56fee13d2207057a2811eb67b217be8330c6ed
   </pre>

2. Using the same key, ssh to the worker node (if you have more than one, repeat the step for all of them).

   ```bash
   ssh -i owasp-key ubuntu@<worker_node_public_ip_address>
   ```

   Paste the `kubeadm join` command copied from the control-plane node.

   The output will look like the following:

   <pre>
   
   </pre>

   From the terminal connected to the control-plane, verify if the node successfuly joined the cluster by running the following command, as `root`:

   ```bash
   kubectl get nodes
   ```

   The output should be:

   <pre>
   NAME            STATUS     ROLES           AGE   VERSION
   control-plane   NotReady   control-plane   28h   v1.26.5
   worker-01       NotReady   &lt;none&gt;          27h   v1.26.5
   </pre>

   The STATUS is `NotReady` because the CNI is not installed yet. Let's move to the next step to configure and install the Calico CNI.

---

[:arrow_right: 3 - Install and Configure the Calico CNI](/demo/03-calico-installation.md) <br>

[:arrow_left: 1 - Infrastructure for the Demo](/demo/01-infrastructure.md)  
[:leftwards_arrow_with_hook: Back to Main](/README.md)  